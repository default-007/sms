{% extends "base.html" %}
{% load static %}

{% block title %}Password Reset Sent{% endblock %}

{% block extra_css %}
<style>
  .success-card {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    border: none;
  }

  .success-content {
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.95);
    border: none;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  }

  .success-animation {
    animation: bounceIn 1s ease-out;
  }

  @keyframes bounceIn {
    0% {
      opacity: 0;
      transform: scale(0.3);
    }

    50% {
      opacity: 1;
      transform: scale(1.05);
    }

    70% {
      transform: scale(0.9);
    }

    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  .pulse-animation {
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.05);
    }

    100% {
      transform: scale(1);
    }
  }

  .info-card {
    border-left: 4px solid #17a2b8;
    background: rgba(23, 162, 184, 0.1);
  }

  .step-item {
    transition: all 0.3s ease;
  }

  .step-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }
</style>
{% endblock %}

{% block content %}
<div class="min-vh-100 d-flex align-items-center py-5"
  style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-xl-6 col-lg-7 col-md-9">
        <!-- Main Success Card -->
        <div class="success-animation">
          <div class="card success-card border-0 shadow-lg mb-4">
            <div class="card-body p-0">
              <!-- Header -->
              <div class="text-center py-5">
                <div class="mb-4">
                  <div class="pulse-animation">
                    <i class="fas fa-paper-plane fa-4x text-white mb-3"></i>
                  </div>
                  <h2 class="text-white mb-2">Reset Instructions Sent!</h2>
                  <p class="text-white-50">Check your email for password reset instructions</p>
                </div>
              </div>

              <!-- Content Section -->
              <div class="px-5 pb-5">
                <div class="card success-content">
                  <div class="card-body p-4">
                    <div class="text-center mb-4">
                      <div class="alert alert-success border-0 mb-4">
                        <div class="d-flex align-items-center">
                          <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                          <div class="text-start">
                            <h5 class="alert-heading mb-1">Email Sent Successfully</h5>
                            <p class="mb-0">
                              We've sent password reset instructions to your email address.
                            </p>
                          </div>
                        </div>
                      </div>

                      <!-- Next Steps -->
                      <h5 class="mb-3">What to do next:</h5>
                    </div>

                    <!-- Step-by-step instructions -->
                    <div class="row g-3 mb-4">
                      <div class="col-md-6">
                        <div class="card step-item border-0 shadow-sm h-100">
                          <div class="card-body text-center p-3">
                            <div
                              class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2"
                              style="width: 40px; height: 40px;">
                              <span class="fw-bold">1</span>
                            </div>
                            <h6 class="mb-2">Check Your Email</h6>
                            <p class="small text-muted mb-0">
                              Look for an email from our system with reset instructions.
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="card step-item border-0 shadow-sm h-100">
                          <div class="card-body text-center p-3">
                            <div
                              class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-2"
                              style="width: 40px; height: 40px;">
                              <span class="fw-bold">2</span>
                            </div>
                            <h6 class="mb-2">Click the Link</h6>
                            <p class="small text-muted mb-0">
                              Click the secure reset link in the email to continue.
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Important Information -->
                    <div class="alert alert-info border-0 mb-4 info-card">
                      <h6 class="mb-2">
                        <i class="fas fa-info-circle me-2"></i>
                        Important Information
                      </h6>
                      <ul class="small mb-0 ps-3">
                        <li class="mb-1">The reset link will expire in <strong>1 hour</strong> for security</li>
                        <li class="mb-1">The link can only be used once</li>
                        <li class="mb-1">If you don't see the email, check your spam folder</li>
                        <li class="mb-0">You can request a new reset link if this one expires</li>
                      </ul>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2">
                      <button type="button" class="btn btn-primary btn-lg" onclick="checkEmailClient()">
                        <i class="fas fa-envelope-open me-2"></i>
                        Open Email Client
                      </button>
                      <div class="row">
                        <div class="col-6">
                          <a href="{% url 'accounts:login' %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back to Login
                          </a>
                        </div>
                        <div class="col-6">
                          <a href="{% url 'accounts:password_reset' %}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-redo me-2"></i>
                            Resend Email
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Troubleshooting Section -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-light">
            <h6 class="mb-0">
              <i class="fas fa-question-circle text-info me-2"></i>
              Not receiving the email?
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <h6 class="small mb-2">Common Issues:</h6>
                <ul class="small mb-0">
                  <li class="mb-1">Check your spam/junk folder</li>
                  <li class="mb-1">Verify the email address is correct</li>
                  <li class="mb-1">Wait a few minutes for delivery</li>
                  <li class="mb-0">Email filters may block messages</li>
                </ul>
              </div>
              <div class="col-md-6">
                <h6 class="small mb-2">Need Help?</h6>
                <ul class="small mb-0">
                  <li class="mb-1">
                    <a href="#" onclick="showContactInfo()">Contact Support</a>
                  </li>
                  <li class="mb-1">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#faqModal">View FAQ</a>
                  </li>
                  <li class="mb-1">
                    <a href="#" onclick="reportIssue()">Report Email Issue</a>
                  </li>
                  <li class="mb-0">
                    <a href="{% url 'accounts:password_reset' %}">Try Different Email</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Email Security Notice -->
        <div class="text-center">
          <small class="text-muted">
            <i class="fas fa-shield-alt me-1"></i>
            For your security, we never include passwords in emails.
            Only secure reset links are sent.
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- FAQ Modal -->
<div class="modal fade" id="faqModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-question-circle text-primary me-2"></i>
          Frequently Asked Questions
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="accordion" id="faqAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                How long does it take to receive the reset email?
              </button>
            </h2>
            <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Reset emails are typically delivered within 2-5 minutes. During peak times, it may take up to 10
                minutes.
                If you haven't received it after 15 minutes, please check your spam folder or try requesting a new reset
                link.
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                How long is the reset link valid?
              </button>
            </h2>
            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                For security reasons, password reset links expire after 1 hour. If your link has expired,
                simply request a new one using the same process.
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                Can I use the reset link multiple times?
              </button>
            </h2>
            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                No, each reset link can only be used once for security purposes. After you successfully reset your
                password,
                the link becomes invalid. If you need to reset your password again, you'll need to request a new link.
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                What if I don't have access to my email?
              </button>
            </h2>
            <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                If you no longer have access to your registered email address, please contact our support team directly.
                They will help you verify your identity and update your account information.
                <br><br>
                <strong>Support Contact:</strong><br>
                Email: support@schoolsms.com<br>
                Phone: +1 (555) 123-4567
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Contact Info Modal -->
<div class="modal fade" id="contactModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-headset text-primary me-2"></i>
          Contact Support
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <i class="fas fa-life-ring fa-3x text-primary mb-3"></i>
          <h5>We're here to help!</h5>
        </div>

        <div class="list-group">
          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
              <h6 class="mb-1">
                <i class="fas fa-envelope text-primary me-2"></i>Email Support
              </h6>
              <small>24/7</small>
            </div>
            <p class="mb-1">support@schoolsms.com</p>
            <small>Response within 4 hours</small>
          </div>

          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
              <h6 class="mb-1">
                <i class="fas fa-phone text-success me-2"></i>Phone Support
              </h6>
              <small>Mon-Fri</small>
            </div>
            <p class="mb-1">+1 (555) 123-4567</p>
            <small>8 AM - 6 PM EST</small>
          </div>

          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
              <h6 class="mb-1">
                <i class="fas fa-comments text-info me-2"></i>Live Chat
              </h6>
              <small>Mon-Fri</small>
            </div>
            <p class="mb-1">Available on our website</p>
            <small>9 AM - 5 PM EST</small>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Auto-redirect to login after 10 minutes
    setTimeout(() => {
      if (confirm('Would you like to return to the login page?')) {
        window.location.href = '{% url "accounts:login" %}';
      }
    }, 600000); // 10 minutes

    // Check if user has been waiting too long
    setTimeout(() => {
      if (document.visibilityState === 'visible') {
        showDelayedEmailHelp();
      }
    }, 300000); // 5 minutes
  });

  function checkEmailClient() {
    // Try to open default email client
    const emailClients = [
      'mailto:',
      'https://gmail.com',
      'https://outlook.live.com',
      'https://mail.yahoo.com'
    ];

    // Try to open mailto first
    window.location.href = 'mailto:';

    // Show additional options after a delay
    setTimeout(() => {
      if (confirm('Did your email client open? If not, would you like to access webmail instead?')) {
        const choice = prompt(
          'Choose your email provider:\n' +
          '1. Gmail\n' +
          '2. Outlook\n' +
          '3. Yahoo Mail\n' +
          'Enter 1, 2, or 3:'
        );

        switch (choice) {
          case '1':
            window.open('https://gmail.com', '_blank');
            break;
          case '2':
            window.open('https://outlook.live.com', '_blank');
            break;
          case '3':
            window.open('https://mail.yahoo.com', '_blank');
            break;
          default:
            break;
        }
      }
    }, 2000);
  }

  function showContactInfo() {
    const modal = new bootstrap.Modal(document.getElementById('contactModal'));
    modal.show();
  }

  function reportIssue() {
    // This would integrate with a support ticket system
    const userAgent = navigator.userAgent;
    const timestamp = new Date().toISOString();

    const emailBody = `
I am experiencing issues receiving the password reset email.

Details:
- Time: ${timestamp}
- Browser: ${userAgent}
- Issue: Password reset email not received

Please assist me with resetting my password.

Thank you!
    `.trim();

    const mailtoLink = `mailto:support@schoolsms.com?subject=Password Reset Email Issue&body=${encodeURIComponent(emailBody)}`;
    window.location.href = mailtoLink;
  }

  function showDelayedEmailHelp() {
    const delayedHelpModal = `
        <div class="modal fade" id="delayedHelpModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title">
                            <i class="fas fa-clock me-2"></i>
                            Still waiting for the email?
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>It's been a few minutes since you requested the password reset. Here are some things you can try:</p>
                        <ul>
                            <li>Check your spam/junk folder</li>
                            <li>Make sure you entered the correct email address</li>
                            <li>Try requesting a new reset link</li>
                            <li>Contact support if you continue having issues</li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <a href="{% url 'accounts:password_reset' %}" class="btn btn-primary">
                            Request New Link
                        </a>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            Keep Waiting
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;

    document.body.insertAdjacentHTML('beforeend', delayedHelpModal);
    const modal = new bootstrap.Modal(document.getElementById('delayedHelpModal'));
    modal.show();
  }
</script>
{% endblock %}