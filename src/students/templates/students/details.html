<ul class="dropdown-menu dropdown-menu-end">
  <li>
    <a href="/students/${student.id}/attendance/" class="dropdown-item">
      <i class="fas fa-clipboard-check me-2"></i> Attendance
    </a>
  </li>
  <li>
    <a href="/exams/results/?student_id=${student.id}" class="dropdown-item">
      <i class="fas fa-file-alt me-2"></i> Exam Results
    </a>
  </li>
  <li>
    <a href="/finance/fees/?student_id=${student.id}" class="dropdown-item">
      <i class="fas fa-money-bill-wave me-2"></i> Fee Details
    </a>
  </li>
  <li>
    <hr class="dropdown-divider">
  </li>
  <li>
    <a href="/students/${student.id}/id-card/" class="dropdown-item">
      <i class="fas fa-id-card me-2"></i> ID Card
    </a>
  </li>
</ul>
</div>
</div>
`;

const statusBadge = `<span class="badge bg-${this.getStatusBadge(student.status)}">${student.status}</span>`;

this.dataTable.row.add([
student.admission_number,
`<div class="d-flex align-items-center">
  <img src="${student.profile_picture || '/static/images/default-avatar.png'}" alt="${student.name}"
    class="table-avatar me-2">
  <div>
    <div class="fw-bold">${student.name}</div>
    <div class="small text-muted">${student.email}</div>
  </div>
</div>`,
student.class_name,
student.gender,
student.admission_date,
student.phone_number,
statusBadge,
actions
]);
});

this.dataTable.draw();
})
.catch(error => {
console.error('Error fetching students:', error);
showAlert('danger', 'Failed to fetch students. Please try again.');
});
},

getStatusBadge(status) {
const badges = {
'active': 'success',
'inactive': 'warning',
'graduated': 'info',
'transferred': 'secondary',
'suspended': 'danger'
};
return badges[status.toLowerCase()] || 'secondary';
},

exportCsv() {
window.location.href =
`/api/v1/students/export?format=csv&class_id=${this.filters.class}&status=${this.filters.status}&search=${this.filters.search}`;
},

printList() {
const printWindow = window.open('', '_blank');

printWindow.document.write(`
<html>

  <head>
    <title>Students List</title>
    <link rel="stylesheet" href="/static/vendors/bootstrap/css/bootstrap.min.css">
    <style>
      body {
        padding: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      th {
        background-color: #f2f2f2;
      }

      .header {
        margin-bottom: 20px;
        text-align: center;
      }

      .logo {
        height: 60px;
        margin-bottom: 10px;
      }

      @media print {
        .no-print {
          display: none;
        }
      }
    </style>
  </head>

  <body>
    <div class="header">
      <img src="/static/images/logo.png" alt="School Logo" class="logo">
      <h2>School Management System</h2>
      <h3>Students List</h3>
      <p>Generated on ${new Date().toLocaleDateString()}</p>
    </div>
    <button class="btn btn-primary no-print" onclick="window.print()">Print</button>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Class</th>
          <th>Gender</th>
          <th>Admission Date</th>
          <th>Contact</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        ${Array.from(this.dataTable.rows().data()).map(row => {
        const data = row;
        return `
        <tr>
          <td>${data[0]}</td>
          <td>${this.stripHtml(data[1])}</td>
          <td>${data[2]}</td>
          <td>${data[3]}</td>
          <td>${data[4]}</td>
          <td>${data[5]}</td>
          <td>${this.stripHtml(data[6])}</td>
        </tr>
        `;
        }).join('')}
      </tbody>
    </table>
    <div class="mt-3 text-center">
      <p>Â© ${new Date().getFullYear()} School Management System. All rights reserved.</p>
    </div>
  </body>

</html>
`);

printWindow.document.close();
printWindow.focus();
},

stripHtml(html) {
const temp = document.createElement('div');
temp.innerHTML = html;
return temp.textContent || temp.innerText || '';
}
};
}
</script>
{% endblock %}